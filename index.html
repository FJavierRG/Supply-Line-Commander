<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Supply Line Commander - Log√≠stica Militar</title>
    <link rel="icon" type="image/png" href="assets/sprites/ui/resources.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="src/styles/auth.css">
    <script>
        // Configurar URL base de la API (servidor Node.js)
        // El servidor corre en el mismo puerto que el cliente (8000)
        window.__API_BASE_URL__ = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:8000'
            : '';
    </script>
</head>
<body>
    <div id="auth-overlay" class="auth-overlay hidden">
        <div class="auth-modal">
            <div class="auth-header">
                <h1>Supply Line Commander</h1>
            </div>
            <div class="auth-tabs">
                <button class="auth-tab-button active" data-auth-tab="login">Iniciar sesi√≥n</button>
                <button class="auth-tab-button" data-auth-tab="register">Crear cuenta</button>
            </div>
            <form id="auth-login-form" class="auth-form">
                <div class="auth-field">
                    <label for="auth-login-username">Nombre de usuario</label>
                    <input id="auth-login-username" name="username" type="text" autocomplete="username" placeholder="tu_usuario" required>
                </div>
                <div class="auth-field">
                    <label for="auth-login-password">Contrase√±a</label>
                    <input id="auth-login-password" name="password" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="auth-submit">Entrar</button>
            </form>
            <form id="auth-register-form" class="auth-form hidden">
                <div class="auth-field">
                    <label for="auth-register-username">Nombre de usuario</label>
                    <input id="auth-register-username" name="username" type="text" autocomplete="username" placeholder="elige_un_nombre" required>
                </div>
                <div class="auth-field">
                    <label for="auth-register-password">Contrase√±a</label>
                    <input id="auth-register-password" name="password" type="password" autocomplete="new-password" placeholder="m√≠nimo 6 caracteres" required>
                </div>
                <div class="auth-field">
                    <label for="auth-register-confirm">Confirmar contrase√±a</label>
                    <input id="auth-register-confirm" name="confirmPassword" type="password" autocomplete="new-password" placeholder="repite tu contrase√±a" required>
                </div>
                <button type="submit" class="auth-submit">Crear cuenta</button>
            </form>
        </div>
    </div>
    <div id="game-container">
        <div id="main-game">
            <canvas id="game-canvas"></canvas>
            
            <!-- Slider de c√°mara horizontal -->
            <div id="camera-slider-container">
                <input type="range" id="camera-slider" min="0" max="100" value="0" step="1">
            </div>
            
            <!-- Sistema de notificaciones -->
            <div id="notification-container"></div>
            
            
            <button id="start-timer-btn" class="game-start-overlay-btn">
                Comenzar
            </button>
            
            
            
            
            <!-- Botones de desarrollo -->
            <button id="dev-supply-enemy-btn" style="position: absolute; top: 10px; right: 10px; padding: 8px 15px; background: rgba(139, 0, 0, 0.8); color: white; border: 2px solid #8b0000; border-radius: 5px; font-family: monospace; font-weight: bold; cursor: pointer; z-index: 1000; display: none;">
                ENEMIGO
            </button>
            
            <!-- Bot√≥n volver al editor (solo visible durante playtest) -->
            <button id="back-to-editor-btn" style="display: none; position: absolute; top: 10px; right: 130px; padding: 8px 15px; background: rgba(66, 133, 244, 0.9); color: white; border: 2px solid #4285f4; border-radius: 5px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-weight: bold; cursor: pointer; z-index: 1000;">
                ‚Üê Editor
            </button>
            
            <!-- Capa de UI (nueva estructura) -->
            <div id="ui-layer">
            <!-- Pantalla de carga -->
            <div id="loading-screen" class="overlay">
                <div class="loading-container">
                    <h1 class="loading-title">Supply Line Commander</h1>
                    <div class="loading-spinner"></div>
                    <div class="loading-bar-container">
                        <div class="loading-bar-fill" id="loading-bar-fill"></div>
                    </div>
                    <p class="loading-text" id="loading-text">Cargando recursos...</p>
                    <p class="loading-percentage" id="loading-percentage">0%</p>
                </div>
            </div>

            <!-- Pantalla "Press to Continue" -->
            <div id="press-to-continue-screen" class="overlay hidden">
                <div class="press-to-continue-container">
                    <p class="press-to-continue-text">Pulsa para continuar</p>
                </div>
            </div>

            <div id="main-menu-overlay" class="overlay hidden">
                <!-- Contenedor de lluvia -->
                <div class="rain-container">
                    <!-- Gotas desde arriba - m√°s gotas para cubrir m√°s espacio -->
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <div class="rain-drop"></div>
                    <!-- Gotas desde la izquierda -->
                    <div class="rain-drop rain-from-left"></div>
                    <div class="rain-drop rain-from-left"></div>
                    <div class="rain-drop rain-from-left"></div>
                    <div class="rain-drop rain-from-left"></div>
                    <div class="rain-drop rain-from-left"></div>
                    <div class="rain-drop rain-from-left"></div>
                    <div class="rain-drop rain-from-left"></div>
                    <div class="rain-drop rain-from-left"></div>
                    <!-- Gotas desde la derecha -->
                    <div class="rain-drop rain-from-right"></div>
                    <div class="rain-drop rain-from-right"></div>
                    <div class="rain-drop rain-from-right"></div>
                    <div class="rain-drop rain-from-right"></div>
                    <div class="rain-drop rain-from-right"></div>
                    <div class="rain-drop rain-from-right"></div>
                    <div class="rain-drop rain-from-right"></div>
                    <div class="rain-drop rain-from-right"></div>
                </div>
                
                <div class="main-menu-container">
                    <div class="menu-header">
                        <h1 class="menu-title">Supply Line Commander</h1>
                        <div id="user-info" class="user-info" style="display: none;">
                            <span id="username-display" class="username-display"></span>
                            <button id="logout-btn" class="logout-btn">Cerrar Sesi√≥n</button>
                        </div>
                    </div>
                    
                    <div class="menu-actions">
                        <button id="play-btn" class="menu-btn primary">Jugar</button>
                        <button id="tutorial-btn" class="menu-btn secondary">Tutorial</button>
                        <button id="arsenal-btn" class="menu-btn secondary">Arsenal</button>
                        <button id="options-btn" class="menu-btn secondary">Opciones</button>
                        <button id="exit-btn" class="menu-btn secondary">Salir</button>
                    </div>
                </div>
            </div>

            <!-- ELIMINADO: Selector de Dificultad Singleplayer (ahora se configura en el lobby) -->

            <!-- Lobby Multijugador -->
            <div id="multiplayer-lobby-overlay" class="overlay hidden">
                <div class="main-menu-container">
                    <div class="menu-header">
                        <button id="lobby-back-btn" class="back-btn">‚Üê Volver</button>
                    </div>
                    
                    <!-- Vista inicial: Crear o unirse -->
                    <div id="lobby-initial-view" class="menu-actions">
                        <div id="lobby-status" style="color: white; margin-bottom: 20px; font-size: 18px;">
                            Conectando al servidor...
                        </div>
                        
                        <button id="create-room-btn" class="menu-btn primary">Crear Sala</button>
                        <button id="join-room-btn" class="menu-btn secondary">Unirse a Sala</button>
                        
                        <div id="room-code-input-container" style="display: none; margin-top: 20px;">
                            <input type="text" id="room-code-input" placeholder="C√≥digo de sala (4 letras)" 
                                   maxlength="4" style="padding: 10px; font-size: 18px; text-align: center; text-transform: uppercase; width: 200px;">
                            <button id="join-with-code-btn" class="menu-btn primary" style="margin-top: 10px;">Unirse</button>
                        </div>
                    </div>
                    
                    <!-- Vista dentro de la sala -->
                    <div id="lobby-room-view" style="display: none; padding: 20px; max-width: 1200px; margin: 0 auto;">
                        <!-- C√≥digo de sala -->
                        <div style="text-align: center; margin-bottom: 30px;">
                            <p style="color: #888; font-size: 14px; margin-bottom: 5px;">C√ìDIGO DE SALA</p>
                            <p id="room-code-display" style="font-size: 32px; font-weight: bold; color: #4ecca3; letter-spacing: 8px; text-shadow: 0 0 10px rgba(78, 204, 163, 0.5);"></p>
                        </div>
                        
                        <!-- Layout de dos columnas -->
                        <div style="display: flex; gap: 30px; align-items: flex-start;">
                            <!-- Columna izquierda: Jugadores y selecci√≥n de razas -->
                            <div style="flex: 1; min-width: 400px;">
                                <!-- Lista de jugadores -->
                                <div style="margin-bottom: 30px;">
                                    <h3 style="color: #4ecca3; margin-bottom: 15px; font-size: 18px; text-transform: uppercase; letter-spacing: 2px;">JUGADORES</h3>
                                    <div id="players-list">
                                        <!-- Se llenar√° din√°micamente -->
                                    </div>
                                    
                                    <!-- Slot de IA (Player 2) -->
                                    <div id="ai-slot" style="
                                        background: rgba(0, 0, 0, 0.5);
                                        border: 2px solid #555;
                                        border-radius: 8px;
                                        padding: 15px;
                                        margin-top: 15px;
                                    ">
                                        <div id="ai-slot-empty" style="text-align: center;">
                                            <p style="color: #888; margin-bottom: 10px;">Slot vac√≠o</p>
                                            <button id="add-ai-btn" class="menu-btn secondary" style="padding: 8px 20px; font-size: 14px;">+ A√±adir IA</button>
                                        </div>
                                        
                                        <div id="ai-slot-config" style="display: none;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                                <span style="color: #4ecca3; font-weight: bold;">ü§ñ IA</span>
                                                <button id="remove-ai-btn" class="menu-btn secondary" style="padding: 5px 15px; font-size: 12px;">Quitar</button>
                                            </div>
                                            
                                            <div style="display: flex; gap: 10px; flex-direction: column;">
                                                <div>
                                                    <label style="color: #888; font-size: 12px; display: block; margin-bottom: 5px;">NACI√ìN</label>
                                                    <select id="ai-race-select" style="
                                                        width: 100%;
                                                        padding: 8px;
                                                        background: rgba(0, 0, 0, 0.7);
                                                        border: 2px solid #333;
                                                        border-radius: 5px;
                                                        color: white;
                                                        font-size: 14px;
                                                    ">
                                                        <option value="A_Nation">Fuerzas Unificadas</option>
                                                    </select>
                                                </div>
                                                
                                                <div>
                                                    <label style="color: #888; font-size: 12px; display: block; margin-bottom: 5px;">DIFICULTAD</label>
                                                    <select id="ai-difficulty-select" style="
                                                        width: 100%;
                                                        padding: 8px;
                                                        background: rgba(0, 0, 0, 0.7);
                                                        border: 2px solid #333;
                                                        border-radius: 5px;
                                                        color: white;
                                                        font-size: 14px;
                                                    ">
                                                        <option value="easy">F√°cil</option>
                                                        <option value="medium" selected>Medio</option>
                                                        <option value="hard">Dif√≠cil</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Botones de acci√≥n -->
                                <div style="display: flex; gap: 15px; justify-content: center; align-items: center;">
                                    <button id="ready-toggle-btn" class="menu-btn primary">Marcar Listo</button>
                                    <button id="start-multiplayer-game-btn" class="menu-btn primary" style="display: none;">Comenzar Partida</button>
                                </div>
                            </div>
                            
                            <!-- Columna derecha: Chat -->
                            <div style="flex: 1; min-width: 400px;">
                                <div id="chat-messages" style="
                                    height: 300px;
                                    overflow-y: auto;
                                    background: rgba(0, 0, 0, 0.7);
                                    border: 2px solid #333;
                                    border-radius: 5px;
                                    padding: 15px;
                                    margin-bottom: 15px;
                                    font-family: monospace;
                                    font-size: 14px;
                                ">
                                    <!-- Mensajes se a√±aden aqu√≠ -->
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="chat-input" placeholder="Escribe un mensaje..." style="
                                        flex: 1;
                                        padding: 12px;
                                        background: rgba(0, 0, 0, 0.7);
                                        border: 2px solid #333;
                                        border-radius: 5px;
                                        color: white;
                                        font-size: 14px;
                                    " maxlength="100">
                                    <button id="chat-send-btn" class="menu-btn secondary" style="padding: 12px 20px;">Enviar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Constructor de Mazos (antes Arsenal) -->
            <div id="arsenal-overlay" class="overlay hidden">
                <div class="arsenal-container">
                    <div class="arsenal-header">
                        <button id="arsenal-back-btn" class="back-btn">‚Üê Volver</button>
                        <h2 class="arsenal-title">Constructor de Mazos</h2>
                        <div class="arsenal-header-right">
                            <button id="arsenal-new-btn" class="back-btn">Nuevo</button>
                            <button id="arsenal-load-btn" class="back-btn">Cargar</button>
                        </div>
                    </div>

                    <div class="arsenal-body">
                        <!-- Panel izquierdo: Unidades disponibles -->
                        <div class="arsenal-left-section">
                            <div class="deck-panel available-panel">
                                <!-- üÜï NUEVO: Tabs para Unidades / Disciplinas -->
                                <div class="arsenal-tabs">
                                    <button class="arsenal-tab active" id="arsenal-tab-units" data-tab="units">
                                        Unidades
                                    </button>
                                    <button class="arsenal-tab" id="arsenal-tab-disciplines" data-tab="disciplines">
                                        Disciplinas
                                    </button>
                                </div>
                                <div class="arsenal-content" id="arsenal-content">
                                    <!-- El contenido se generar√° din√°micamente -->
                                </div>
                            </div>
                            <div class="arsenal-help-text">
                                <span class="help-text-item">
                                    <img src="assets/sprites/ui/mouse_click.png" alt="Click izquierdo" class="help-icon">
                                    <span id="arsenal-help-left">Click izq a√±adir carta</span>
                                </span>
                                <span class="help-text-separator">/</span>
                                <span class="help-text-item">
                                    <img src="assets/sprites/ui/mouse_click.png" alt="Click derecho" class="help-icon help-icon-mirror">
                                    <span id="arsenal-help-right">Click der ver info</span>
                                </span>
                            </div>
                        </div>

                        <!-- Panel derecho: Mazo/Banquillo (seg√∫n selector) -->
                        <div class="deck-panel">
                            <div class="deck-panel-header">
                                <h3 class="panel-title" id="deck-panel-title">Tu Mazo</h3>
                                <div class="deck-header-right">
                                    <div class="deck-destination-selector">
                                        <button class="destination-btn active" id="destination-deck-btn" data-destination="deck" title="A√±adir al mazo">
                                            Mazo
                                        </button>
                                        <button class="destination-btn" id="destination-bench-btn" data-destination="bench" title="A√±adir al banquillo">
                                            Banquillo
                                        </button>
                                    </div>
                                    <div class="deck-counter">
                                        <span id="deck-count">0</span> / <span id="deck-limit">-</span> puntos
                                    </div>
                                </div>
                            </div>
                            <div class="deck-list" id="deck-list">
                                <div class="deck-empty">Tu mazo est√° vac√≠o. Haz clic en las unidades disponibles para a√±adirlas.</div>
                            </div>
                            
                            <!-- Panel de detalle (mantener pero adaptado) -->
                            <aside class="arsenal-detail" id="arsenal-detail">
                                <canvas id="detail-canvas" class="detail-canvas" width="307" height="205"></canvas>
                                <div class="detail-info ui-frame">
                                    <p class="detail-name">Pasa el rat√≥n por un elemento</p>
                                    <p class="detail-cost"></p>
                                    <p class="detail-desc"></p>
                                </div>
                            </aside>
                            
                            <!-- Botones de acci√≥n del mazo -->
                            <div class="deck-actions">
                                <button id="deck-clear-btn" class="menu-btn secondary">Limpiar</button>
                                <button id="deck-save-btn" class="menu-btn secondary">Guardar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de selecci√≥n de mazos -->
            <div id="deck-selector-overlay" class="overlay hidden">
                <div class="deck-selector-container">
                    <div class="deck-selector-header">
                        <h2 class="deck-selector-title">Seleccionar Mazo</h2>
                        <button id="deck-selector-close-btn" class="back-btn">‚úï Cerrar</button>
                    </div>
                    <div class="deck-selector-body">
                        <div id="deck-selector-list" class="deck-selector-list">
                            <!-- La lista se generar√° din√°micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal para pedir nombre del mazo -->
            <div id="deck-name-modal-overlay" class="overlay hidden">
                <div class="deck-name-modal-container">
                    <div class="deck-name-modal-header">
                        <h2 class="deck-name-modal-title">Nombre del Mazo</h2>
                    </div>
                    <div class="deck-name-modal-body">
                        <p id="deck-name-message" class="deck-name-message" style="display: none;"></p>
                        <input type="text" id="deck-name-input" class="deck-name-input" placeholder="Escribe el nombre del mazo..." maxlength="50" autofocus>
                        <div class="deck-name-modal-actions">
                            <button id="deck-name-cancel-btn" class="menu-btn secondary">Cancelar</button>
                            <button id="deck-name-confirm-btn" class="menu-btn primary">Guardar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal para vista ampliada de carta -->
            <div id="card-zoom-overlay" class="overlay hidden">
                <div class="card-zoom-container">
                    <button id="card-zoom-close-btn" class="card-zoom-close">‚úï</button>
                    <canvas id="card-zoom-canvas" class="card-zoom-canvas" width="600" height="400"></canvas>
                    <div class="card-zoom-info">
                        <h3 id="card-zoom-name" class="card-zoom-name"></h3>
                        <p id="card-zoom-cost" class="card-zoom-cost"></p>
                        <p id="card-zoom-desc" class="card-zoom-desc"></p>
                    </div>
                </div>
            </div>

            <!-- Pantalla de Victoria -->
            <div id="victory-overlay" class="overlay hidden">
                <div class="game-end-container">
                    <div class="game-end-header">
                        <h1 class="game-end-title victory">¬°VICTORIA!</h1>
                    </div>
                    
                    <div class="game-end-graphics">
                        <img src="assets/sprites/ui/victoryLanes.png" alt="Victoria" class="game-end-image">
                    </div>
                    
                    <div class="game-end-actions">
                        <button id="victory-menu-btn" class="game-end-btn">Volver al Men√∫</button>
                    </div>
                </div>
            </div>

            <!-- Pantalla de Derrota -->
            <div id="defeat-overlay" class="overlay hidden">
                <div class="game-end-container">
                    <div class="game-end-header">
                        <h1 class="game-end-title defeat">DERROTA</h1>
                    </div>
                    
                    <div class="game-end-graphics">
                        <!-- Aqu√≠ se podr√≠a poner una imagen de derrota cuando est√© disponible -->
                        <div class="game-end-placeholder">
                            <p style="font-size: 48px; color: #e74c3c; text-shadow: 0 0 20px rgba(231, 76, 60, 0.5);">‚úï</p>
                        </div>
                    </div>
                    
                    <div class="game-end-actions">
                        <button id="defeat-menu-btn" class="game-end-btn">Volver al Men√∫</button>
                    </div>
                </div>
            </div>

            <!-- Men√∫ de Pausa -->
            <div id="pause-overlay" class="overlay hidden">
                <div class="main-menu-container">
                    <div class="menu-header">
                        <h1 class="menu-title">Pausa</h1>
                    </div>
                    
                    <div class="menu-actions">
                        <button id="pause-continue-btn" class="menu-btn primary">Continuar</button>
                        <button id="pause-options-btn" class="menu-btn secondary">Opciones</button>
                        <button id="pause-exit-btn" class="menu-btn secondary">Volver al men√∫</button>
                    </div>
                </div>
            </div>

            <!-- Pantalla de Mejoras -->
            <div id="upgrades-overlay" class="overlay hidden">
                <div class="upgrades-container">
                    <div class="upgrades-header">
                        <button id="close-upgrades-btn" class="back-btn">‚Üê Volver</button>
                        <div class="upgrades-currency">
                            <span id="medals-count-upgrades">0</span>
                            <span class="currency-icon">Medallas</span>
                        </div>
                    </div>
                    
                    <h2 class="upgrades-title">Mejoras Permanentes</h2>
                    
                    <div id="permanent-upgrades">
                        <!-- Construcci√≥n -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Construcci√≥n y Expansi√≥n</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="build">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Sistema de Construcci√≥n</h3>
                                        <p class="upgrade-description">Construye 1 FOB por nivel durante las misiones</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="quick-build">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Construcci√≥n R√°pida</h3>
                                        <p class="upgrade-description">Los FOBs construidos obtienen +30 recursos adicionales</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="fortified-fobs">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">FOBs Fortificados</h3>
                                        <p class="upgrade-description">Los FOBs construidos tienen +30 capacidad m√°xima</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="double-build">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Constructor Experto</h3>
                                        <p class="upgrade-description">Construye hasta 2 FOBs por nivel</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Veh√≠culos -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Veh√≠culos y Capacidad</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="fob-vehicles">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Veh√≠culos FOB Mejorados</h3>
                                        <p class="upgrade-description">Los FOBs tienen +1 veh√≠culo (3 total)</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="hq-vehicles">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Flota HQ Ampliada</h3>
                                        <p class="upgrade-description">El HQ tiene +2 veh√≠culos (8 total)</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="larger-convoys">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Convoyes Pesados</h3>
                                        <p class="upgrade-description">+50% capacidad de carga en todos los veh√≠culos</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="mega-fleet">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Mega Flota</h3>
                                        <p class="upgrade-description">HQ +3 veh√≠culos, FOB +2 veh√≠culos adicionales</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Velocidad -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Velocidad y Eficiencia</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="multi-dispatch">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Doble Despacho</h3>
                                        <p class="upgrade-description">HQ y FOBs pueden enviar 2 veh√≠culos al mismo tiempo</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="faster-convoys">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Motores Mejorados</h3>
                                        <p class="upgrade-description">Todos los veh√≠culos se mueven +30% m√°s r√°pido</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="return-speed">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Retorno R√°pido</h3>
                                        <p class="upgrade-description">Los veh√≠culos vuelven +100% m√°s r√°pido</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="efficient-routes">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Rutas Eficientes</h3>
                                        <p class="upgrade-description">Los veh√≠culos regresan instant√°neamente a su base</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="turbo-mode">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Modo Turbo</h3>
                                        <p class="upgrade-description">Velocidad de veh√≠culos +50% adicional (total +80%)</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Recursos -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Recursos y Econom√≠a</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="front-buffer">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">B√∫nkers Reforzados</h3>
                                        <p class="upgrade-description">Los frentes tienen +30% capacidad m√°xima</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="fast-transfer">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Transferencia Prioritaria</h3>
                                        <p class="upgrade-description">FOBs pueden almacenar +50 recursos (130 total)</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="larger-storage">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Almacenes Ampliados</h3>
                                        <p class="upgrade-description">Todas las bases tienen +30% capacidad m√°xima</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="starting-supplies">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Suministros Iniciales</h3>
                                        <p class="upgrade-description">Los frentes empiezan con recursos al m√°ximo</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="slow-consumption">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Racionamiento Eficiente</h3>
                                        <p class="upgrade-description">Los frentes consumen -20% de recursos</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Pasivas -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Habilidades Pasivas</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="emergency-heli">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Helic√≥ptero de Emergencia</h3>
                                        <p class="upgrade-description">Cada 15s, el HQ env√≠a 20 recursos a cada FOB autom√°ticamente</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="auto-supply">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Log√≠stica Autom√°tica</h3>
                                        <p class="upgrade-description">FOBs env√≠an autom√°ticamente suministros a frentes cr√≠ticos</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div> <!-- Cierre de #ui-layer -->
        </div> <!-- Cierre de #main-game -->

    </div> <!-- Cierre de #game-container -->

    <!-- Men√∫ de opciones -->
    <div id="options-menu" class="options-menu" style="display: none;">
        <div class="options-content">
            <h2>Opciones</h2>
            
            <div class="volume-control">
                <label for="master-volume-slider">Volumen Maestro:</label>
                <div class="slider-container">
                    <input type="range" id="master-volume-slider" min="0" max="100" value="100" class="volume-slider">
                    <span id="master-volume-label" class="volume-label">100%</span>
                </div>
            </div>
            
            <div class="volume-control">
                <label for="music-volume-slider">Volumen M√∫sica:</label>
                <div class="slider-container">
                    <input type="range" id="music-volume-slider" min="0" max="100" value="100" class="volume-slider">
                    <span id="music-volume-label" class="volume-label">100%</span>
                </div>
            </div>
            
            <div class="volume-control">
                <label for="sfx-volume-slider">Volumen Efectos:</label>
                <div class="slider-container">
                    <input type="range" id="sfx-volume-slider" min="0" max="100" value="100" class="volume-slider">
                    <span id="sfx-volume-label" class="volume-label">100%</span>
                </div>
            </div>
            
            <div class="options-buttons">
                <button id="reset-options-btn" class="action-btn">Restaurar por defecto</button>
                <button id="close-options-btn" class="action-btn">Cerrar</button>
            </div>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>

            <div id="upgrades-overlay" class="overlay hidden">
                <div class="upgrades-container">
                    <div class="upgrades-header">
                        <button id="close-upgrades-btn" class="back-btn">‚Üê Volver</button>
                        <div class="upgrades-currency">
                            <span id="medals-count-upgrades">0</span>
                            <span class="currency-icon">Medallas</span>
                        </div>
                    </div>
                    
                    <h2 class="upgrades-title">Mejoras Permanentes</h2>
                    
                    <div id="permanent-upgrades">
                        <!-- Construcci√≥n -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Construcci√≥n y Expansi√≥n</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="build">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Sistema de Construcci√≥n</h3>
                                        <p class="upgrade-description">Construye 1 FOB por nivel durante las misiones</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="quick-build">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Construcci√≥n R√°pida</h3>
                                        <p class="upgrade-description">Los FOBs construidos obtienen +30 recursos adicionales</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="fortified-fobs">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">FOBs Fortificados</h3>
                                        <p class="upgrade-description">Los FOBs construidos tienen +30 capacidad m√°xima</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="double-build">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Constructor Experto</h3>
                                        <p class="upgrade-description">Construye hasta 2 FOBs por nivel</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Veh√≠culos -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Veh√≠culos y Capacidad</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="fob-vehicles">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Veh√≠culos FOB Mejorados</h3>
                                        <p class="upgrade-description">Los FOBs tienen +1 veh√≠culo (3 total)</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="hq-vehicles">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Flota HQ Ampliada</h3>
                                        <p class="upgrade-description">El HQ tiene +2 veh√≠culos (8 total)</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="larger-convoys">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Convoyes Pesados</h3>
                                        <p class="upgrade-description">+50% capacidad de carga en todos los veh√≠culos</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="mega-fleet">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Mega Flota</h3>
                                        <p class="upgrade-description">HQ +3 veh√≠culos, FOB +2 veh√≠culos adicionales</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Velocidad -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Velocidad y Eficiencia</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="multi-dispatch">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Doble Despacho</h3>
                                        <p class="upgrade-description">HQ y FOBs pueden enviar 2 veh√≠culos al mismo tiempo</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="faster-convoys">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Motores Mejorados</h3>
                                        <p class="upgrade-description">Todos los veh√≠culos se mueven +30% m√°s r√°pido</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="return-speed">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Retorno R√°pido</h3>
                                        <p class="upgrade-description">Los veh√≠culos vuelven +100% m√°s r√°pido</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="efficient-routes">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Rutas Eficientes</h3>
                                        <p class="upgrade-description">Los veh√≠culos regresan instant√°neamente a su base</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="turbo-mode">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Modo Turbo</h3>
                                        <p class="upgrade-description">Velocidad de veh√≠culos +50% adicional (total +80%)</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Recursos -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Recursos y Econom√≠a</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="front-buffer">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">B√∫nkers Reforzados</h3>
                                        <p class="upgrade-description">Los frentes tienen +30% capacidad m√°xima</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="fast-transfer">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Transferencia Prioritaria</h3>
                                        <p class="upgrade-description">FOBs pueden almacenar +50 recursos (130 total)</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="larger-storage">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Almacenes Ampliados</h3>
                                        <p class="upgrade-description">Todas las bases tienen +30% capacidad m√°xima</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="starting-supplies">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Suministros Iniciales</h3>
                                        <p class="upgrade-description">Los frentes empiezan con recursos al m√°ximo</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="slow-consumption">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Racionamiento Eficiente</h3>
                                        <p class="upgrade-description">Los frentes consumen -20% de recursos</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Pasivas -->
                        <div class="upgrade-tree-category">
                            <h3 class="upgrade-category-title">Habilidades Pasivas</h3>
                            <div class="upgrade-tree-row">
                                <div class="upgrade-item" data-upgrade="emergency-heli">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Helic√≥ptero de Emergencia</h3>
                                        <p class="upgrade-description">Cada 15s, el HQ env√≠a 20 recursos a cada FOB autom√°ticamente</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                                <div class="upgrade-item" data-upgrade="auto-supply">
                                    <div class="upgrade-content">
                                        <h3 class="upgrade-name">Log√≠stica Autom√°tica</h3>
                                        <p class="upgrade-description">FOBs env√≠an autom√°ticamente suministros a frentes cr√≠ticos</p>
                                    </div>
                                    <div class="upgrade-action"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>
